<!DOCTYPE html>
<html lang="en">
    <head>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            
            
            
            <link rel="shortcut icon" href="../../img/favicon.ico">
            <title>Bmob文档中心</title>
            <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
            <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
            <link href="../../css/base.css" rel="stylesheet">
            <link rel="stylesheet" href="../../css/highlight.css">
            <link href="../../css/agate.css" rel="stylesheet">
            <link href="../../css/custom.css" rel="stylesheet" id="custom">
    </head>

    <body >

        <div class="navbar navbar-fixed-top" role="navigation">
    <div class="main-nav">
        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <a class="navbar-brand" href="../..">
                <!--Bmob文档中心-->
                <img src="../../img/logo.png" alt="">
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

          <ul class="nav navbar-nav">
            
              <li class="pull-left">
                
					<a href="../..">文档首页</a>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="">数据服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">数据服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
								<li >
									<a href="../../data/android/">Android</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/ios/">iOS</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/csharp/">C#</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/php/">PHP</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/go/">GO</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/restful/">RESTful</a>
                                </li>
                            
                            
								<li >
									<a href="../../data/javascript/">JavaScript</a>
                                </li>
                            
                            
                                <li >
                                    <a href="../../data/cocos2d_x/">Cocos2D-X</a>
                                </li>
							
                            
								<li >
									<a href="../../data/wechat_app/">小程序</a>
                                </li>
                            
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../cloud_function/android/">云函数</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">云函数 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../cloud_function/android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/java/">Java</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/csharp/">C#</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/php/">PHP</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/javascript/">JavaScript</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../cloud_function/restful/">RESTful</a>
                                </li>
							
                            
								<li >
									<a href="../../cloud_function/web/">Web</a>
                                </li>
                            
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left active">
                
					<!--<a href="">支付服务</a>-->
					<li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">支付服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
								<li >
									<a href="../android/">Android</a>
                                </li>
                            
                            
								<li >
									<a href="../ios/">iOS</a>
                                </li>
                            
                            
                                <li class="active">
                                    <a href="./">RESTful</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../sms/android/">短信服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">短信服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../sms/android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../sms/ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../sms/php/">PHP</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../sms/javascript/">JavaScript</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../sms/restful/">RESTful</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="">IM服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">IM服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
								<li >
									<a href="../../im/android/">Android</a>
                                </li>
                            
                            
								<li >
									<a href="../../im/ios/">iOS</a>
                                </li>
                            
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../push/android/">推送服务</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">推送服务 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../push/android/">Android</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../push/ios/">iOS</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../push/php/">PHP</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../push/javascript/">JavaScript</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../push/restful/">RESTful</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li class="pull-left">
                
					<!--<a href="../../other/common_problem/">其他</a>-->
					<li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">其他 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                                <li >
                                    <a href="../../other/common_problem/">常见问题</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../other/error_code/">错误码</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../other/data_safety/">数据安全</a>
                                </li>
							
                            
                                <li >
                                    <a href="../../other/bql/">BQL</a>
                                </li>
							
                        </ul>
                    </li>
                
              </li>
            
              <li>
                  <a href="https://www.bmob.cn/repository/index" target="_blank">知识库</a>
              </li>
              <li>
                  <a href="https://www.bmob.cn/downloads" target="_blank">下载</a>
              </li>
            </ul>
            
        </div>
    </div>
</div>

        <div class="pagebody" id="main-wrapper">
            <div class="sidebar">
                <div class="bs-sidebar hidden-print affix well" role="complementary">

	
		
	
		
				
				
				
				
				
				
				
				
				
		
	
		
				
				
				
				
				
				
				
				
		
	
		
				
				
				
					<div class="code-title">RESTful</div>
				
		
	
		
				
				
				
				
				
		
	
		
				
				
		
	
		
				
				
				
				
				
		
	
		
				
				
				
				
		
	


	<ul class="nav bs-sidenav">
		
			
		
			
		
			
		
			
				
					
						
					
						
					
						
							
								
									
										<li class="active "><a href="#_1">打款需知</a>
											
										</li>
									
										<li class=""><a href="#_2">支付回调</a>
											
										</li>
									
										<li class=""><a href="#_3">查询订单</a>
											
										</li>
									
										<li class=""><a href="#bmob">Bmob支付回调</a>
											
											<ul class="nav nav-l2">
												<li><a class="itm-l2" href="#bmob_1">Bmob异步通知回调（支持微信和支付宝）</a></li>
											</ul>
											
										</li>
									
								
							
						
					
				
			
		
			
		
			
		
			
		
			
		
	</ul>
</div>
            </div>
            <div class="content" role="main">
                <div class="wrap">
                    

<p><strong>注意：目前支付宝无法使用，请用户暂时不要接入，等待官方的恢复公告！</strong></p>
<h2 id="_1">打款需知<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>1.打款前请先在控制台填写以下信息</p>
<p><img alt="" src="./image/14579272227324.jpg" /></p>
<p>2.每月的1、2、16、17号为申请打款时间，15号、月尾日为打款时间，确保用户有半个月的追诉期。Bmob将收取10%手续费。</p>
<h2 id="_2">支付回调<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>如图，可以在支付-支付配置处填入通知url。</p>
<p><img alt="" src="./image/14598448796882.jpg" /></p>
<p>这样在支付成功后会向该url（SDK使用异步通知URL，PHP等调用网页支付的使用同步返回URL）发送post请求，结构如下：</p>
<pre><code>{
    &quot;trade_status&quot;:&quot;1&quot;,
    &quot;out_trade_no&quot;:&quot;809488d695ed42ec56b57546d2df94cc&quot;,
    &quot;trade_no&quot;:&quot;2016033021001004810225607152&quot;
}
</code></pre>

<p>trade_status：表示支付状态，目前只有支付成功才产生回调，值恒为1.
out_trade_no：Bmob返回的订单号
trade_no：支付宝或微信返回的订单号</p>
<h2 id="_3">查询订单<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><strong>请求描述</strong></p>
<p>在进行支付请求后会返回 <code>out_trade_no</code> 订单号，使用该订单号可以查询订单的支付情况。</p>
<p><strong>请求</strong></p>
<ul>
<li>
<p>url ：https://api.bmob.cn/1/pay/out_trade_no</p>
</li>
<li>
<p>method ：GET</p>
</li>
<li>
<p>header:</p>
</li>
</ul>
<pre><code>X-Bmob-Application-Id: Your Application ID
X-Bmob-REST-API-Key: Your REST API Key
Content-Type: application/json
</code></pre>

<p><strong>成功时响应</strong></p>
<ul>
<li>
<p>status: 200 OK</p>
</li>
<li>
<p>body:</p>
</li>
</ul>
<pre><code>{
    name:订单或商品名称 
    body:商品详情  
    create_time:调起支付的时间  
    out_trade_no:Bmob系统的订单号  
    transaction_id:微信或支付宝的系统订单号
    pay_type:WECHATPAY（微信支付）或ALIPAY（支付宝支付） 
    total_fee:订单总金额  
    trade_state:NOTPAY（未支付）或 SUCCESS（支付成功）
}
</code></pre>

<p>失败时返回请看 <a href="../../errorcode/index.html?menukey=otherdoc&amp;key=errorcode#index_支付功能相关错误码" title="支付功能相关错误码">支付功能相关错误码</a></p>
<p><strong>例子</strong></p>
<p>一个查询例子如下：</p>
<pre><code>curl -X GET \
  -H &quot;X-Bmob-Application-Id: Your Application ID&quot;          \
  -H &quot;X-Bmob-REST-API-Key: Your REST API Key&quot;        \
  https://api.bmob.cn/1/pay/9f392618f449a71c6fcfdee38d2b29e4
</code></pre>

<p>其返回值：</p>
<pre><code>{
  &quot;name&quot;: &quot;商品&quot;,
  &quot;body&quot;: &quot;商品详情&quot;,
  &quot;create_time&quot;: &quot;2015-03-24 11:14:58&quot;,
  &quot;out_trade_no&quot;: &quot;9f392618f449a71c6fcfdee38d2b29e4&quot;,
  &quot;transaction_id&quot;: &quot;2015061100001000330057820379&quot;
  &quot;pay_type&quot;: &quot;WECHATPAY&quot;,
  &quot;total_fee&quot;: 0.01,
  &quot;trade_state&quot;: &quot;NOTPAY&quot;,
}
</code></pre>

<h2 id="bmob">Bmob支付回调<a class="headerlink" href="#bmob" title="Permanent link">&para;</a></h2>
<p>Bmob 加入了支付后页面跳转同步通知页面的URL和异步的通知URL功能，可供开发者在应用的设置页面自行增加。</p>
<p>填写页面跳转同步通知页面的URL(return_url)和异步的通知URL(notify_url)的页面在 应用列表-&gt;应用信息-&gt;支付设置 。</p>
<h3 id="bmob_1">Bmob异步通知回调（支持微信和支付宝）<a class="headerlink" href="#bmob_1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>必须保证服务器异步通知页面（notify_url）上无任何字符，如空格、HTML标签、开发系统自带抛出的异常提示信息等；</p>
</li>
<li>
<p>Bmob支付是用POST方式发送异步通知信息，因此该页面中获取参数的方式，如：
request.Form(“out_trade_no”)、$_POST[‘out_trade_no’]；</p>
</li>
<li>
<p>支付宝主动发起通知，该方式才会被启用；</p>
</li>
<li>
<p>只有在Bmob的交易管理中存在该笔交易，且发生了交易状态的改变，Bmob才会通过该方式发起服务器通知；</p>
</li>
<li>
<p>服务器间的交互，不像页面跳转同步通知可以在页面上显示出来，这种交互方式是不可见的；</p>
</li>
<li>
<p>第一次交易状态改变（即时到账中此时交易状态是交易完成）时，不仅页面跳转同步通知页面会启用，而且服务器异步通知页面也会收到Bmob发来的处理结果通知；</p>
</li>
<li>
<p>程序执行完后必须打印输出“success”（不包含引号）。如果商户反馈给Bmob的字符不是success这7个字符，Bmob服务器会不断重发通知，直到超过24小时。</p>
</li>
<li>
<p>一般情况下，24小时以内完成8次通知（通知的间隔频率一般是：2m,10m,10m,1h,2h,6h,15h）；</p>
</li>
<li>
<p>程序执行完成后，该页面不能执行页面跳转。如果执行页面跳转，Bmob会收不到success字符，会被Bmob服务器判定为该页面程序运行出现异常，而重发处理结果通知；</p>
</li>
<li>
<p>异步通URL的调试与运行必须在服务器上，即互联网上能访问；</p>
</li>
<li>
<p>当用户的服务端收到Bmob服务器异步通知的$_POST[‘out_trade_no’]时，应该调起一次查询订单的接口获得订单的状态是1，才能准确的判断该笔订单是成功;</p>
</li>
<li>
<p>支付成功结果以Bmob后台订单列表或查询订单接口查询到的订单状态为准。</p>
</li>
</ol>
                </div>
            </div>
        </div>

        
            <script>var base_url = '../..';</script>
            <script src="../../js/jquery-1.10.2.min.js"></script>
            <script src="../../js/bootstrap-3.0.3.min.js"></script>
            <script src="../../js/highlight.pack.js"></script>
            <script src="../../js/main.js"></script>
            <script src="../../js/base.js"></script>

        <div id="go-top"><i class="fa fa-chevron-up"></i></div>
        <a href="https://docs.bmob.cn/data/Android/a_faststart/doc/index.html" id="back" target="_blank">返回 <br> 旧版</a>
    </body>

</html>